# VRChat連携

VSAはVRChatで撮影した写真から自動的にメタデータを抽出し、保存します。このガイドでは、VSAが保存するメタデータとその仕組みについて説明します。

> **注意（Integral対応状況）**
> Integral対応は現在進行中です。Integral関連のカメラパラメータは一部の数値が正しく記録・表示されない場合があります。

## メタデータの概要

VRChatで写真を撮影すると、VSAは以下の情報を自動的にPNG画像に埋め込みます。

- ワールド情報
- ユーザー情報
- カメラパラメータ
- 撮影日時

これらの情報はPNGファイルのtEXtチャンクに保存され、VSAを使わなくても他のツールで読み取ることができます。

## ワールド情報

撮影時に滞在していたワールドの情報が記録されます。

| 項目 | 説明 | 例 |
|------|------|-----|
| ワールド名 | VRChatのワールド名 | "Japan Shrine" |
| ワールドID | VRChatの内部ID | "wrld_xxx..." |
| インスタンスID | インスタンスの識別子 | "12345~hidden(usr_xxx)" |
| インスタンスタイプ | アクセス権限 | Public, Friends+, Friends, Invite+, InviteOnly |

## ユーザー情報

撮影時のユーザー情報が記録されます。

| 項目 | 説明 |
|------|------|
| 撮影者名 | 写真を撮影したユーザー名 |
| 撮影者ID | VRChatのユーザーID（usr_xxx形式） |
| 参加者リスト | インスタンス内の全ユーザー名 |

参加者リストには、撮影時点でインスタンスにいた全員のユーザー名が含まれます。

## カメラパラメータ

VRChatで使用しているカメラの設定が記録されます。VSAは以下のカメラに対応しています。

### VirtualLens2

VirtualLens2使用時に記録されるパラメータ:

| パラメータ | 説明 |
|-----------|------|
| Aperture | 絞り値（F値） |
| Focal Length | 焦点距離 |
| Exposure | 露出補正 |
| Zoom | ズーム倍率 |
| Brightness | 明るさ |
| Contrast | コントラスト |
| Saturation | 彩度 |
| Sharpness | シャープネス |
| FOV | 視野角 |
| Focus Distance | ピント距離 |

### Integral

Integral使用時に記録されるパラメータ:

| パラメータ | 説明 |
|-----------|------|
| Aperture | 絞り値（F値） |
| Focal Length | 焦点距離 |
| Exposure | 露出補正 |
| Shutter Speed | シャッタースピード |
| Bokeh Shape | ボケの形状 |
| Resolution Scale | 解像度スケール |
| Render Distance | レンダリング距離 |

### 通常カメラ

VRChat標準のカメラを使用している場合は、カメラパラメータは記録されません。

## OSC通信の仕組み

VSAはVRChatとOSC（Open Sound Control）プロトコルで通信し、カメラの設定を取得しています。

### 動作の流れ

1. VRChatでカメラの設定を変更
2. カメラがOSCメッセージを送信
3. VSAがOSCメッセージを受信してメモリに保存
4. 写真撮影時に保存していたカメラ設定を画像に埋め込み

### 必要な設定

OSC通信を有効にするには:

1. VRChatの設定でOSCを有効化
2. 対応カメラ（VirtualLens2またはIntegral）のOSC出力を有効化

## VRChatログの解析

ワールド情報とユーザー情報は、VRChatのログファイルから抽出されます。

### ログファイルの場所

```
%LOCALAPPDATA%Low\VRChat\VRChat\
```

通常は `C:\Users\[ユーザー名]\AppData\LocalLow\VRChat\VRChat\` にあります。

### 抽出される情報

- ワールドへの入室/退出
- ユーザーの参加/退出
- インスタンス情報

## 対応カメラの確認

ギャラリーの詳細表示で、各写真がどのカメラで撮影されたか確認できます。

- VirtualLens2: "VL2"または"VirtualLens2"と表示
- Integral: "Integral"と表示
- 通常カメラ: "Normal Camera"と表示

カメラパラメータはアコーディオン形式で表示され、クリックで展開できます。

## 関連設定

VRChat連携を完全にセットアップするには、ゲーム側設定での追加設定が必要です。

### ゲーム側設定ガイド

[ゲーム側設定ガイド](game-config.md)では、以下の設定について詳しく説明しています:

- **VRChat監視の設定**: VRChatプロセスの自動検知
- **メタデータ出力フォルダ設定**: ログファイルの出力先指定
- **OSC設定**: カメラパラメータ取得の詳細設定
- **トラブルシューティング**: メタデータ未取得時の解決方法

詳細は[ゲーム側設定ガイド](game-config.md)を参照してください。

## トラブルシューティング

### メタデータが記録されない場合

1. **VRChatでOSCが有効か確認**
   - VRChatの設定 > OSC > 有効化

2. **対応カメラを使用しているか確認**
   - VirtualLens2またはIntegralが必要

3. **VSAがバックグラウンドで動作しているか確認**
   - VSAはVRChatの起動中も動作している必要があります

4. **メタデータ出力フォルダを確認**
   - ゲーム側設定で「メタデータ出力フォルダ」が正しく設定されているか確認

### ワールド/ユーザー情報がない場合

1. **VRChatログファイルを確認**
   - ログファイルが正常に出力されているか確認

2. **撮影タイミングを確認**
   - ワールドに入室してすぐの撮影はログが追いつかない場合があります

3. **ゲーム側設定を確認**
   - [ゲーム側設定ガイド](game-config.md)のトラブルシューティングセクションを参照

## 関連情報

- [ゲーム側設定ガイド](game-config.md) - VRChat連携設定の詳細
- [FAQ](faq.md) - よくある質問
- [ユーザー検索機能ガイド](person-search-guide.md) - メタデータを使用した検索

