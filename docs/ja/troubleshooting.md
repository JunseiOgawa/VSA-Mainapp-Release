# トラブルシューティング詳細ガイド

VSAアプリで問題が発生した場合の解決方法をまとめています。段階的に問題解決を進められるように、具体的な症状と解決方法を記載しています。

## よくある問題と解決方法

### インポート関連

#### 写真が自動インポートされない

**症状**: VRChatで写真を撮影しても、VSAに自動的にインポートされない

**考えられる原因**:
- 監視機能が無効になっている
- フォルダパスが不正
- ファイアウォールがブロックしている

**解決方法（段階的）**:

**ステップ1: 監視機能の確認**
1. ゲーム側設定を開く
2. トグルスイッチが「有効（オン）」になっているか確認
3. 無効になっている場合は、クリックして有効化
4. VRChatでスクリーンショットを撮影

**ステップ2: フォルダパスの確認**
1. ゲーム側設定を開く
2. 「スクリーンショットフォルダ」を確認
3. 通常は`C:\Users\[ユーザー名]\Pictures\VRChat`
4. 正しいパスか確認し、必要に応じて再選択

**ステップ3: VRChatの確認**
1. VRChatでスクリーンショットが実際に撮影されているか確認
2. Windowsのエクスプローラーで、指定フォルダに写真ファイルがあるか確認
3. ファイル名と撮影時刻が一致しているか確認

**ステップ4: ファイアウォールの確認**
1. Windowsセキュリティセンターを開く
2. 「ファイアウォールと保護」をクリック
3. 「ファイアウォールによるアプリケーションの許可」をクリック
4. VSAが許可リストに含まれているか確認
5. 含まれていない場合は「別のアプリを許可」から追加

**ステップ5: アプリの再起動**
1. VSAを完全に終了
2. VRChatも終了
3. VSAを再起動
4. VRChatを起動
5. スクリーンショットを撮影

**それでも解決しない場合**:
[ログファイルの確認](#ログファイルの確認方法)を参照して、詳細なエラーを確認してください。

#### サムネイルが表示されない

**症状**: ギャラリーでサムネイルが灰色のまま表示される、または画像が表示されない

**考えられる原因**:
- サムネイル生成処理中
- サムネイル生成に失敗
- キャッシュが破損

**解決方法（段階的）**:

**ステップ1: 処理完了まで待機**
1. ギャラリーを表示
2. 画面上部の「処理中...」インジケーターを確認
3. インジケーターが消えるまで待機（数分かかる場合があります）

**ステップ2: スクロール操作を試す**
1. ギャラリーを上下にスクロール
2. スクロール時に動的にサムネイルが読み込まれます
3. ネットワーク接続を確認（外部ストレージの場合）

**ステップ3: アプリの再起動**
1. VSAを完全に終了
2. 数秒待機
3. VSAを再起動
4. ギャラリーを表示

**ステップ4: キャッシュのクリア**
1. VSAを終了
2. 以下のフォルダを削除:
   ```
   %APPDATA%/VSA/cache/
   ```
3. VSAを再起動
4. サムネイルが再生成されます（時間がかかる場合があります）

**ステップ5: データベースの再構築**
1. 開発者モードを有効化（設定 > 外観 > 開発者モード）
2. サイドバーに「開発者」メニューが表示
3. 「開発者」をクリック
4. 「データベースを再構築」をクリック
5. 確認ダイアログで「OK」を選択
6. VSAを再起動

**注意**: データベース再構築すると、お気に入りタグなどが失われる可能性があります。

### ギャラリー表示関連

#### ギャラリーの動作が重い

**症状**: 写真の表示やスクロールが遅い、フリーズすることがある

**考えられる原因**:
- 大量の写真をロード中
- サムネイルサイズが大きすぎる
- アニメーション設定が有効
- メモリ不足

**解決方法（優先度順）**:

**対策1: サムネイルサイズを縮小**
1. ギャラリーを表示
2. ツールバーのズームスライダーを左にドラッグ
3. サムネイルサイズを小さくします
4. スクロール速度が改善されるか確認

**対策2: アニメーションを無効化**
1. 設定を開く
2. 「アニメーション」パネルを選択
3. アニメーション効果を無効化
4. 画面エフェクトが軽くなります

**対策3: 不要な写真を削除**
1. ギャラリーで不要な写真を選択
2. 削除ボタンをクリック
3. 総ファイル数が減ると、処理負荷が軽減

**対策4: アプリを再起動**
1. VSAを完全に終了
2. 数秒待機
3. VSAを再起動
4. メモリがリセットされます

**対策5: PCのメモリを確認**
1. タスクマネージャーを開く（Ctrl + Shift + Esc）
2. 「パフォーマンス」タブをクリック
3. メモリ使用率を確認
4. 90%以上の場合は、PC自体のメモリ不足です
5. 他のアプリケーションを閉じてください

#### 写真が表示されない

**症状**: ギャラリーに何も表示されない、または「写真がありません」と表示される

**考えられる原因**:
- インポートが完了していない
- フォルダパスが不正
- 写真ファイルが削除されている

**解決方法（段階的）**:

**ステップ1: インポートフォルダを確認**
1. ゲーム側設定を開く
2. 「スクリーンショットフォルダ」パスを確認
3. Windowsエクスプローラーでそのフォルダを開く
4. 写真ファイルが存在するか確認（`.png`または`.jpg`ファイル）

**ステップ2: インポート処理を確認**
1. インポートフォルダビューを開く
2. 処理中のインジケーターを確認
3. インジケーターが消えるまで待機

**ステップ3: 手動リロード**
1. ギャラリーを表示
2. ツールバーの「リロード」ボタン（⟲）をクリック
3. 写真一覧を再読み込み

**ステップ4: データベースを確認**
1. 開発者モードを有効化
2. 開発者メニューから「データベース情報」を表示
3. 「総写真数」を確認
4. 0の場合、ファイアウォールがブロックしている可能性

### JXL圧縮関連

#### 圧縮が開始されない

**症状**: 自動圧縮が設定した時刻に開始されない、またはスケジュール機能が動作しない

**考えられる原因**:
- 自動圧縮機能が無効
- VRChatが起動している
- システム時刻がズレている

**解決方法（段階的）**:

**ステップ1: 自動圧縮の有効確認**
1. ゲーム側設定を開く
2. 詳細設定を展開
3. 「自動圧縮機能」が有効（トグルオン）か確認
4. 無効の場合は有効化して保存

**ステップ2: VRChat状態を確認**
1. VRChatが起動していないか確認
2. 起動している場合は終了
3. VRChatを完全に終了してから、スケジュール時刻まで待機

**ステップ3: システム時刻の確認**
1. Windowsの時刻を確認
2. タスクバーの時刻をクリック
3. 正確な時刻か確認
4. ズレている場合は、タイムサーバーと同期（自動設定が通常）

**ステップ4: 手動で圧縮を実行**
1. JPEG XL圧縮ビューを開く
2. 「フォルダを選択」から圧縮対象フォルダを選択
3. 「圧縮を実行」ボタンをクリック
4. 手動実行で動作するか確認

#### 圧縮後に画質が劣化する

**症状**: JPEG XL圧縮後、画像が破損したり、色が変わったりする

**解決方法**:

VSAのJPEG XL圧縮は**ロスレス（可逆）圧縮**のため、画質は劣化しません。以下の原因が考えられます：

**原因1: 元の画像が既に圧縮されている**
- VRChatが出力する画像は既に圧縮されているため、さらなる圧縮による視覚的な変化はありません
- これは正常な動作です

**原因2: ビューアーがJXLに対応していない**
- Windows標準の「フォト」アプリはJXLに対応していません
- JXL対応ビューアーをインストール:
  - IrfanView（無料）
  - FastStone Image Viewer（無料）
  - その他のJXL対応画像ビューアー

**原因3: ファイルが破損している**
1. 詳細ログを確認（開発者モード）
2. エラーがある場合は、圧縮をやり直す
3. 同じエラーが発生する場合は、元のファイルが破損している可能性

### VRChat連携関連

#### メタデータが取得できない

**症状**: 写真のワールド名、ユーザー名、撮影日時などが表示されない

**考えられる原因**:
- メタデータ出力が無効
- ログフォルダパスが不正
- VRChatが古いバージョン

**解決方法（段階的）**:

**ステップ1: メタデータ出力フォルダを確認**
1. ゲーム側設定を開く
2. 詳細設定を展開
3. 「メタデータ出力フォルダ」が設定されているか確認
4. 設定されていない場合は、VRChatのログフォルダを指定

**ステップ2: VRChat側の設定を確認**
1. VRChatの設定メニューを開く
2. メタデータ出力が有効か確認
3. 無効の場合は有効化
4. VRChatを再起動

**ステップ3: ログフォルダの確認**
1. ゲーム側設定で表示されているログフォルダパスを確認
2. Windowsエクスプローラーでそのフォルダを開く
3. `output.log`などのログファイルが存在するか確認
4. 存在しない場合は、ログフォルダパスを再設定

**ステップ4: 新しいスクリーンショットを撮影**
1. すべての設定が完了してから、新しくスクリーンショットを撮影
2. 既存の写真にはメタデータが付与されません
3. 新しい写真にメタデータが付与されるか確認

#### OSC通信が確立できない

**症状**: カメラパラメータ（VirtualLens2など）が取得できない

**考えられる原因**:
- OSCポート番号が一致していない
- VRChat側でOSCが無効
- ファイアウォールがブロック
- ポート番号が使用中

**解決方法（段階的）**:

**ステップ1: ポート番号の確認**
1. ゲーム側設定を開く
2. 詳細設定を展開
3. 「OSCポート」を確認（デフォルト: 9001）
4. VRChat側の設定でも同じポート番号が設定されているか確認

**ステップ2: VRChat側でOSCを有効化**
1. VRChatを起動
2. 設定メニューを開く
3. 「OSCを有効にする」をチェック
4. VRChatを再起動

**ステップ3: ファイアウォール設定を確認**
1. Windowsセキュリティセンターを開く
2. 「ファイアウォールと保護」をクリック
3. 「詳細設定」をクリック
4. 「受信の規則」と「送信の規則」で、OSCポート（9001など）が許可されているか確認
5. 許可されていない場合は、新しい規則を追加

**ステップ4: ポート番号の競合を確認**
1. コマンドプロンプトを開く（Windows + R → cmd）
2. 以下のコマンドを実行:
   ```
   netstat -ano | findstr :9001
   ```
3. 他のプロセスがポートを使用していないか確認
4. 使用している場合は、別のポート番号に変更

**ステップ5: VSAの再起動**
1. VSAを完全に終了
2. 数秒待機
3. VSAを再起動
4. VRChatでカメラを使用

#### VRChat起動が検出されない

**症状**: VRChatを起動しても、VSAが検出しない（通知が表示されない）

**考えられる原因**:
- 監視機能が無効
- VRChatプロセスの検出に失敗

**解決方法**:

**ステップ1: 監視機能の有効確認**
1. ゲーム側設定を開く
2. トグルスイッチが有効（オン）か確認

**ステップ2: VRChatを再起動**
1. VRChatを完全に終了
2. VSAも再起動
3. VRChatを起動

### Google Drive連携関連

#### アップロードが失敗する

**症状**: お気に入り写真をGoogle Driveにアップロードしようとするとエラーになる

**考えられる原因**:
- ネットワーク接続がない
- Google Driveのストレージが満杯
- 認証が失効している

**解決方法（段階的）**:

**ステップ1: ネットワーク接続を確認**
1. Windowsのネットワークアイコンを確認
2. インターネット接続が正常か確認
3. 別のブラウザでGoogle Driveにアクセス
4. アクセスできない場合は、Wi-Fiルーターを再起動

**ステップ2: Google Driveのストレージを確認**
1. Google Driveをブラウザで開く
2. ストレージ使用量を確認
3. 満杯の場合は、不要なファイルを削除
4. 無料プランの場合は有料プランへのアップグレードを検討

**ステップ3: 認証状態を確認**
1. アカウント設定を開く
2. Google Driveの認証状態を確認
3. 「ログアウト」をクリック
4. 「Google Driveでログイン」をクリックして再認証

**ステップ4: 手動アップロードを試す**
1. お気に入り機能ガイドの「手動アップロード」手順に従う
2. 手動でアップロード可能か確認
3. 可能の場合は、自動アップロード設定を見直す

#### 認証エラーが発生する

**症状**: Google Driveログイン時に「認証に失敗しました」というエラーが表示される

**考えられる原因**:
- ブラウザのキャッシュが破損
- Google アカウントのセキュリティ設定
- ポップアップブロック

**解決方法（段階的）**:

**ステップ1: ブラウザのキャッシュをクリア**
1. ブラウザを開く（Chrome推奨）
2. Ctrl + Shift + Delete
3. 「キャッシュされた画像とファイル」をチェック
4. 「閲覧履歴を削除」をクリック

**ステップ2: ポップアップブロックを確認**
1. ブラウザのアドレスバー左側のアイコンを確認
2. ポップアップがブロックされている場合は許可

**ステップ3: 別のブラウザで試す**
1. 別のブラウザ（EdgeやFirefoxなど）で試す
2. 認証成功するか確認

**ステップ4: Googleアカウントのセキュリティ設定**
1. Google アカウント設定を開く
2. 「セキュリティ」をクリック
3. 「安全性の低いアプリへのアクセス」を確認
4. 必要に応じて設定を調整

**ステップ5: VSAアプリを再起動**
1. VSAを完全に終了
2. 数秒待機
3. VSAを再起動して再度ログイン

### 通知関連

#### 通知が表示されない

**症状**: 設定では通知が有効になっているが、デスクトップ通知が表示されない

**考えられる原因**:
- Windows通知設定でVSAが許可されていない
- 集中モードが有効
- 通知音量がミュート

**解決方法（段階的）**:

**ステップ1: Windows通知設定を確認**
1. Windowsの設定を開く（Windows + I）
2. 「システム」をクリック
3. 「通知」をクリック
4. VSAが許可リストに含まれているか確認
5. 含まれていない場合は、「許可されたアプリ」から追加

**ステップ2: 集中モードを確認**
1. Windowsのアクションセンター（Win + A）を開く
2. 「集中モード」が「オン」になっていないか確認
3. オンの場合はオフに切り替え

**ステップ3: 通知設定を確認**
1. VSAの設定を開く
2. 「通知」パネルを選択
3. 「デスクトップ通知」が有効か確認
4. 個別の通知種別が有効か確認

**ステップ4: 通知音を確認**
1. Windowsの音量ミキサーを確認
2. VSAアプリがミュートされていないか確認
3. マスターボリュームを確認

### パフォーマンス関連

#### アプリの起動が遅い

**症状**: VSAの起動に数十秒以上かかる

**考えられる原因**:
- データベースが大きい
- 写真数が多い
- ディスクが遅い

**解決方法（優先度順）**:

**対策1: 不要な写真を削除**
1. ギャラリーで古い写真を選択
2. 削除ボタンをクリック
3. データベースサイズが削減されます
4. 起動速度が改善するか確認

**対策2: ディスクの最適化**
1. Windowsの設定を開く
2. 「ストレージ」をクリック
3. 「ドライブの最適化」をクリック
4. ドライブを選択して「最適化」をクリック

**対策3: SSDにインストール**
- VSAをSSDにインストールすると、起動速度が向上します
- HDD環境の場合は、SSDへの移行を検討してください

#### メモリ使用量が多い

**症状**: VSAのメモリ使用量が増加し続ける、またはPCが遅くなる

**考えられる原因**:
- 大量の写真をロード中
- メモリリーク
- サムネイルキャッシュが大きい

**解決方法（優先度順）**:

**対策1: サムネイルサイズを小さくする**
1. ギャラリーを表示
2. ズームスライダーを左にドラッグ
3. サムネイルサイズを縮小
4. メモリ使用量が削減されるか確認

**対策2: 詳細サイドバーを閉じる**
1. 開いている写真詳細を閉じる
2. メモリ使用量が削減されるか確認

**対策3: アプリを再起動**
1. VSAを完全に終了
2. 数秒待機
3. VSAを再起動
4. メモリがリセットされます

**対策4: キャッシュをクリア**
1. VSAを終了
2. 以下のフォルダを削除:
   ```
   %APPDATA%/VSA/cache/
   ```
3. VSAを再起動

## ログファイルの確認方法

VSAの詳細なログを確認することで、問題の原因をより正確に特定できます。

### ログファイルの場所

```
%APPDATA%/VSA/logs/
```

**ショートカット**:
1. Windowsキー + R
2. `%APPDATA%`と入力してEnter
3. `VSA`フォルダをダブルクリック
4. `logs`フォルダをダブルクリック

### ログファイルの構成

ログファイルは日付ごとに生成されます：

```
logs/
├── 2024-01-10.log
├── 2024-01-09.log
└── 2024-01-08.log
```

**最新のログファイルを開く**: 今日の日付のファイルを開きます。

### ログファイルの読み方

ログファイルはテキストファイルです。メモ帳やVSCodeで開くことができます。

**ログレベルの見方**:

| ログレベル | 記号 | 意味 |
|----------|------|------|
| ERROR | [ERROR] | 重大なエラー（問題が発生している） |
| WARN | [WARN] | 警告（注意が必要） |
| INFO | [INFO] | 通常の情報（参考情報） |
| DEBUG | [DEBUG] | デバッグ情報（開発者向け） |

**エラーの確認方法**:
1. テキストエディタで最新のログファイルを開く
2. Ctrl + F で「ERROR」を検索
3. エラーメッセージを確認
4. エラーメッセージに基づいて対処

**例**:
```
[2024-01-10 14:32:15] [ERROR] Failed to connect to screenshot folder: Access Denied
```

このエラーは、スクリーンショットフォルダへのアクセス権限がないことを示しています。

## データベースの再構築

データベースが破損した場合、再構築できます。

**注意**: 再構築すると、お気に入りタグなどのカスタムデータが失われる可能性があります。事前にバックアップを取ってください。

### 手順

**ステップ1: 開発者モードを有効化**
1. 設定を開く
2. 「外観」パネルを選択
3. 「開発者モード」を有効化
4. 「保存」をクリック

**ステップ2: 開発者メニューを開く**
1. サイドバーに「開発者」メニューが表示される
2. 「開発者」をクリック

**ステップ3: データベースを再構築**
1. 「データベースを再構築」ボタンを探す
2. クリック
3. 確認ダイアログで「再構築」を選択

**ステップ4: アプリを再起動**
1. VSAが自動的に再起動
2. データベース再構築が完了します

**ステップ5: 確認**
1. ギャラリーを表示
2. 写真が正常に表示されるか確認

## 設定ファイルのリセット

設定ファイルが破損した場合、リセットできます。

**警告**: リセット後は、すべての設定がデフォルトに戻ります。重要な設定は事前にメモしてください。

### 手順

**ステップ1: VSAを終了**
1. VSAを完全に終了
2. 全VSAプロセスが終了しているか確認（タスクマネージャーで確認）

**ステップ2: 設定ファイルを削除**
1. Windowsキー + R
2. `%APPDATA%`と入力してEnter
3. `VSA`フォルダを開く
4. `settings.json`ファイルを削除

**ステップ3: VSAを再起動**
1. VSAを起動
2. セットアップウィザードが表示される
3. 初期設定を再度実施

**バックアップの作成方法**:
1. VSAを終了
2. `%APPDATA%/VSA/settings.json`をコピー
3. 安全な場所に`settings.json.backup`として保存

**バックアップから復元**:
1. `settings.json.backup`を`%APPDATA%/VSA/`フォルダにコピー
2. `settings.json`にリネーム
3. VSAを再起動

## サポートへの問い合わせ方法

上記の解決方法で問題が解決しない場合、サポートに問い合わせることができます。

### 問い合わせに必要な情報

以下の情報をまとめて提供してください：

**1. 環境情報**:
- VSAバージョン（設定 > アップデート で確認）
- Windowsバージョン（Windows + R → winver）
- PCスペック（CPU、メモリ、ディスク）

**2. 問題の詳細**:
- 発生している具体的な症状
- いつから発生しているか
- 発生の再現手順

**3. エラーメッセージ**:
- 表示されているエラーメッセージをスクリーンショット

**4. ログファイル**:
- 最新のログファイル（`%APPDATA%/VSA/logs/[日付].log`）

### 問い合わせ先

**GitHub Issues**:
- [VSA-MainApp Issues](https://github.com/your-repo/issues)
- GitHubアカウントが必要です
- 詳細な情報をテンプレートに従って記載

**メール**:
- support@vsa-app.com（仮）
- 詳細な問い合わせ内容と上記の情報を記載

## 関連情報

- [FAQ](faq.md) - よくある質問
- [ゲーム側設定ガイド](game-config.md) - 設定トラブル
- [設定画面完全ガイド](settings-guide.md) - 設定の詳細
- [お気に入い機能ガイド](favorites-guide.md) - Google Drive連携トラブル
