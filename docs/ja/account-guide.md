# アカウント管理ガイド

アカウント管理画面では、Google Driveなどのクラウドサービスのアカウントを接続し、写真のクラウドバックアップを設定できます。このガイドでは、アカウント機能の詳しい使い方について説明します。

## 概要

アカウント管理では以下のことができます：

- **Google Driveへのログイン**: OAuth2認証でセキュアに接続
- **自動アップロード設定**: お気に入い写真を自動的にクラウド保存
- **手動アップロード**: すぐにアップロードしたい場合に実行
- **Google Driveフォルダを開く**: ブラウザで直接Google Driveを確認

## アカウント管理画面へのアクセス

サイドバーの「アカウント」をクリックして、アカウント管理画面を開きます。

## Google Driveアカウント

### ログイン方法（OAuth2認証フロー）

Google Driveと連携するには、Googleアカウントで認証する必要があります。このプロセスはセキュアなOAuth2プロトコルで行われます。

**ステップ1: ログインボタンをクリック**
1. アカウント管理画面を開く
2. 「Google Driveでログイン」ボタンを探す
3. ボタンをクリック

**ステップ2: Webブラウザが自動的に開く**
1. Google のログインページがブラウザで表示される
2. Googleアカウントのメールアドレスを入力
3. パスワードを入力

**ステップ3: アカウント選択**
複数のGoogleアカウントがある場合：
1. 使用するアカウントを選択
2. または、別のアカウントを選択する場合は「別のアカウントを使用」をクリック

**ステップ4: アクセス権限を確認・承認**
1. VSAがGoogle Driveにアクセスする権限の詳細が表示される
2. 許可される権限を確認
3. 「許可」または「承認」ボタンをクリック

**ステップ5: 自動的にVSAに戻る**
1. ブラウザから自動的にVSAアプリケーションに戻ります
2. アカウント画面で「ログイン中」と表示される

**ステップ6: 確認**
アカウント画面に以下が表示されます：
- ログイン済みの表示
- Googleアカウントのメールアドレス
- 「ログアウト」ボタン

### 認証待機状態の説明

ログインボタンをクリックしてからブラウザで認証を完了するまでの間、アカウント画面は「認証待ち中...」と表示されます。

**待機時間**:
- 最大5分間待機可能
- この間、VSAアプリケーションを操作してもかまいません
- ブラウザで認証を完了するまで、待機状態が続きます

### 認証キャンセル方法

認証を途中でキャンセルしたい場合：

**方法1: ブラウザを閉じる**
1. Google認証ページを閉じる
2. VSAの認証待機状態が自動的にタイムアウト

**方法2: キャンセルボタンをクリック**
1. アカウント画面の「キャンセル」ボタン（あれば）をクリック
2. 認証待機状態がクリアされます

### ログアウト方法

Google Driveとの接続を削除したい場合：

**ステップ**:
1. アカウント管理画面を開く
2. ログイン済みの状態で「ログアウト」ボタンを探す
3. ボタンをクリック
4. 確認ダイアログで「ログアウト」を選択
5. ログアウト完了

**ログアウト後**:
- Google Driveへのアップロード機能が無効になります
- 再度ログインする場合は、「Google Driveでログイン」から手順を繰り返します

### Google Driveを開く

ブラウザでGoogle Driveを直接開きたい場合：

**ステップ**:
1. 「Google Driveを開く」ボタンをクリック
2. ブラウザでGoogle Driveが開く
3. VSAのファイルが保存された「VSA」フォルダを確認可能

**VSAフォルダについて**:
- 自動的に作成されるフォルダ
- お気に入い写真がアップロードされる場所
- フォルダを他のユーザーと共有可能（Google Drive機能）

## アップロード設定

### 自動アップロードの有効化

お気に入いに追加した写真を自動的にGoogle Driveにアップロードする機能です。

**有効化方法**:
1. Google Driveにログイン済みであることを確認
2. 「自動アップロード」トグルを探す
3. トグルをオンに切り替え
4. 設定が保存される

**自動アップロードの動作**:
- お気に入いボタンをクリック → 自動的にGoogle Driveへアップロード開始
- 数秒～数十秒でアップロード完了
- ネットワーク接続が必要

**オフにする場合**:
- トグルをオフに切り替え
- 以後、手動でアップロードする必要があります

### 手動アップロードの実行

すぐにお気に入い写真をアップロードしたい場合：

**ステップ**:
1. アカウント管理画面で「今すぐアップロード」ボタンを探す
2. ボタンをクリック
3. アップロード処理が開始
4. 進捗バーでアップロード状況を確認

**処理時間**:
- 写真数: 1～10枚 → 数秒～1分
- 写真数: 11～50枚 → 1～5分
- 写真数: 50枚以上 → 5～30分以上（ネットワーク速度に依存）

**アップロード中の表示**:
- 進捗率（%）
- 処理済みファイル数（「3 / 10」など）
- 現在処理中のファイル情報

**ネットワーク接続**:
- アップロード中はインターネット接続が必要
- 接続が途中で切れた場合、アップロードが中断されます
- 再度「今すぐアップロード」を実行して続行

## プライバシーとセキュリティ

### データの保存場所

**認証トークン**:
- ローカルコンピューターに暗号化して保存
- VSAのみがアクセス可能

**写真データ**:
- Google Drive内の「VSA」フォルダに保存
- あなた専用のプライベートフォルダ
- 共有設定しない限り、他者がアクセスできません

### アクセス権限

VSAが要求するGoogle Drive権限：

**許可される権限**:
- Google Driveの読み取り/書き込み権限（VSAフォルダのみ）
- ファイルのアップロード権限

**許可されない権限**:
- メール、カレンダー、ドキュメント等への アクセス
- 他のクラウドサービスへのアクセス
- Googleアカウントの変更

### パスワード管理

**パスワードはVSAに保存されません**:
- OAuth2認証を使用
- パスワードはGoogle に送信される（VSAを経由しない）
- VSAに保存されるのはアクセストークンのみ
- トークンは暗号化されます

### トークンの失効

Google のセキュリティシステムにより、トークンが失効する場合があります：

**失効理由**:
- Googleセキュリティ設定の変更
- 長期間未使用
- 不正アクセスの疑い

**再度ログイン**:
- 「再度ログイン」ボタンが表示されます
- クリックして認証を再度実施

## VSAアカウント（Supabase連携）

※現在開発者モードでのみ利用可能です。今後の公開予定があります。

このアカウントタイプは、VSAのプレミアム機能（クラウドストレージ、同期機能など）を利用するために開発中です。

## トラブルシューティング

### 認証がタイムアウトする

**症状**: 「認証がタイムアウトしました」というエラーメッセージ

**原因と対策**:

**ブラウザでポップアップがブロックされている**:
1. ブラウザのアドレスバーを確認
2. ポップアップブロックアイコン（🚫）が表示されていないか確認
3. ブロックを許可：「このサイトのポップアップを常に許可」を選択

**セキュリティソフトが通信をブロック**:
1. セキュリティソフトの設定を確認
2. VSAをホワイトリストに追加
3. ファイアウォール設定を緩和してみる

**ネットワーク接続が不安定**:
1. インターネット接続を確認
2. Wi-Fi接続を確認
3. 有線接続に切り替えてみる

**解決方法**:
1. ブラウザのキャッシュをクリア
2. 別のブラウザで試す（Chrome推奨）
3. VSAアプリを再起動

### ブラウザで認証が完了しない

**症状**: ブラウザで「許可」をクリックしたのに、VSAに戻らない

**原因と対策**:

**ブラウザのキャッシュが破損**:
1. ブラウザを開く
2. Ctrl + Shift + Delete
3. 「キャッシュされた画像とファイル」をチェック
4. 「閲覧履歴を削除」をクリック

**別のブラウザで試す**:
1. Chrome、Edge、Firefoxなど別のブラウザを試す
2. Chrome推奨

**ファイアウォール設定を確認**:
1. Windowsセキュリティセンターを開く
2. 「ファイアウォールと保護」を確認
3. VSAが許可されているか確認

### ログアウトできない

**症状**: 「ログアウト」をクリックしてもログアウトされない

**原因と対策**:

**トークンが無効**:
1. VSAを再起動
2. アカウント画面を再度開く

**ブラウザキャッシュ**:
1. ブラウザのキャッシュをクリア
2. VSAを再起動

**設定ファイルのリセット**:
1. VSAを終了
2. `%APPDATA%/VSA/`フォルダを開く
3. `account.json`ファイルを削除
4. VSAを再起動

### 認証エラーが発生する

**症状**: 「Google認証に失敗しました」というエラー

**考えられる原因**:
- Googleアカウントのセキュリティ設定
- ブラウザの設定
- VSAの設定

**解決方法**:

**ステップ1: Googleアカウントのセキュリティ設定を確認**
1. https://myaccount.google.com/ にアクセス
2. 「セキュリティ」タブを開く
3. 「安全性の低いアプリへのアクセス」を確認
4. 必要に応じて設定を調整

**ステップ2: ブラウザのキャッシュをクリア**
1. Ctrl + Shift + Delete
2. すべての項目をチェック
3. 「閲覧履歴を削除」をクリック

**ステップ3: VSAを再起動**
1. VSAを完全に終了
2. 数秒待機
3. VSAを再起動
4. 再度ログインを試す

## ヒント

- **複数アカウント**: 複数のGoogleアカウントがある場合、アカウント選択時に「別のアカウントを使用」を選択
- **Google Driveの共有**: VSA フォルダを他のユーザーと共有することで、写真を一緒に管理可能
- **セキュリティ**: 定期的にGoogle アカウント設定でアクセス権限を確認
- **オフライン時**: インターネット接続がない場合、アップロード機能は使用できません

## 関連情報

- [お気に入い機能ガイド](favorites-guide.md) - Google Drive連携の詳細
- [設定画面完全ガイド](settings-guide.md) - アカウント関連設定
- [トラブルシューティング詳細ガイド](troubleshooting.md) - より詳しい問題解決方法
