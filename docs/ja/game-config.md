# ゲーム側設定ガイド

ゲーム側設定では、VRChat連携に必要なフォルダやOSC通信の設定を行います。この設定を正しく行うことで、VRChatの写真撮影を自動検知し、メタデータを取得できます。

## 概要

ゲーム側設定は以下の3つのタブで構成されています：

- **画面設定タブ**: VRChatの写真撮影を検知するファイル監視のオン/オフ、フォルダパスやOSC通信の詳細設定
- **タイムマシーンタブ**: VRChatのインスタンス履歴表示と再参加機能
- **サーバータブ**: VRChatサーバーステータス監視

各タブは画面上部のタブバーから切り替えられます。

## タブ構成

### 画面設定タブ

デフォルトで開かれるタブです。VRChatの写真撮影検知とOSC通信の設定を行います。

詳細は以下の「監視状態の管理」および「詳細設定」セクションを参照してください。

### タイムマシーンタブ

VRChatの過去のインスタンス履歴を表示し、過去に訪れたワールドに再参加できます。

詳細は「タイムマシーン機能」セクションを参照してください。

### サーバータブ

VRChatサーバーのステータスを監視し、メンテナンス情報などを確認できます。

詳細は「サーバーステータス機能」セクションを参照してください。

## 監視状態の管理

### 監視の開始/停止

ゲーム側設定画面の上部にある**トグルスイッチ**で監視のオン/オフを切り替えられます。

- **有効（オン）**: VRChatでスクリーンショットを撮影すると、自動的にVSAに検知されます
- **無効（オフ）**: VRChatの活動が検知されません。設定変更時や、一時的に監視を停止したい場合に使用します

**ヒント**: 初回セットアップ後は、監視をオンにしておくことをお勧めします。

### 監視状態の確認方法

トグルスイッチの横に現在の状態を示すインジケーターが表示されます：

- **✓ 監視中**: VRChat写真撮影を検知しています
- **停止**: 監視が停止しています

## 詳細設定

「詳細設定」セクションは、デフォルトでは折りたたまれています。セクションのヘッダーをクリックして展開できます。

### フォルダ設定

VRChatの写真やメタデータの保存先フォルダを指定します。

#### スクリーンショットフォルダ設定

**説明**: VRChatが写真を保存するフォルダを指定します。

**初期値**: `C:\Users\[ユーザー名]\Pictures\VRChat`

**設定方法**:
1. 「スクリーンショットフォルダ」の選択ボタンをクリック
2. フォルダ選択ダイアログが開きます
3. VRChatの写真フォルダを選択（通常は`Pictures\VRChat`）
4. 「フォルダを選択」をクリック

**重要**: このフォルダは、VSAがVRChatの写真を自動検知するために使用されます。正しいパスを設定してください。

#### メタデータ出力フォルダ設定

**説明**: VRChatのワールド名やユーザー名などのメタデータを出力するフォルダを指定します。

**初期値**: スクリーンショットフォルダの同じディレクトリ

**設定方法**:
1. 「メタデータ出力フォルダ」の選択ボタンをクリック
2. フォルダ選択ダイアログが開きます
3. メタデータの出力先を選択
4. 「フォルダを選択」をクリック

**ヒント**: VRChatのログフォルダと同じ場所に設定することをお勧めします。

#### ログフォルダ設定

**説明**: VRChatのログファイルが保存されるフォルダを指定します。メタデータの読み込みに使用されます。

**初期値**: VRChatのデフォルトログフォルダ（自動検知）

**設定方法**:
1. 「ログフォルダ」の選択ボタンをクリック
2. フォルダ選択ダイアログが開きます
3. VRChatのログフォルダを選択
4. 「フォルダを選択」をクリック

**デフォルトに戻す**: 「デフォルトに戻す」ボタンをクリックすると、自動検知に戻ります。

**ツールチップでフルパス表示**: 各フォルダ設定の横に、設定されているフルパスが表示されます。マウスをホバーするとツールチップで詳細を確認できます。

### 自動機能設定

VRChatの活動に応じた自動処理を設定します。

#### 自動インポート機能

**説明**: VRChatで撮影した写真を自動的にVSAにインポートします。

**使い方**:
1. トグルスイッチで有効化
2. VRChatでスクリーンショットを撮影
3. 数秒後にVSAのギャラリーに追加されます

**注意**: 監視が有効になっていることを確認してください。

#### 自動圧縮機能

**説明**: VRChatを終了したときに、自動的にJPEG XL圧縮を実行します。

**使い方**:
1. トグルスイッチで有効化
2. 圧縮タイミングを設定（VRChat終了時に実行）
3. VRChatを終了すると自動的に圧縮が開始されます

**設定**: 詳細は[JXL圧縮ガイド](jxl-compression.md)を参照してください。

#### バックグラウンド処理設定

**説明**: アプリ起動時にバックグラウンドで処理を実行するかを設定します。

**使い方**:
1. トグルスイッチで有効化
2. VRChatやインポート処理をバックグラウンドで実行
3. VSAで他の操作を継続できます

### OSC設定

VRChatとの双方向通信（Open Sound Control）を設定します。これにより、VirtualLens2などのカメラパラメータを取得できます。

#### OSCポート設定

**説明**: OSC通信に使用するポート番号を指定します。

**デフォルト**: 9001

**設定方法**:
1. 数値入力フィールドに目的のポート番号を入力
2. VRChat側でも同じポート番号を設定してください

**重要**: VRChat側のOSC設定と一致する必要があります。

#### OSC通信の仕組み

**VRChatとVSAの通信フロー**:
1. VSAがOSCサーバーを起動（指定されたポート番号）
2. VRChatがOSCメッセージを送信
3. VSAがカメラパラメータを受信・記録

**対応するカメラ**:
- VirtualLens2（ズーム、フォーカス距離、絞り値など）
- Integral（シャッター速度、ボケ形状など）
- 通常カメラ

#### カメラパラメータの取得

写真詳細サイドバーの「カメラ情報」セクションで、以下のパラメータを確認できます：

**VirtualLens2パラメータ**:
- Aperture（絞り値）
- Focal Length（焦点距離）
- Exposure（露出）
- Depth of Field（被写界深度）

**Integralパラメータ**:
- Shutter Speed（シャッター速度）
- Bokeh Shape（ボケ形状）
- Film Grain（フィルムグレイン）

## 設定の保存

### 変更検知機能

設定を変更すると、自動的に画面上部に「未保存の変更があります」というインジケーターが表示されます。

### 保存ボタン

詳細設定の下部にある**「設定を保存」ボタン**をクリックすると、すべての変更が保存されます。

### 保存成功/失敗のフィードバック

**保存成功時**:
- 緑色のメッセージ「設定を保存しました」が表示
- インジケーターが消える

**保存失敗時**:
- 赤色のエラーメッセージが表示
- 解決方法を確認して再度保存してください

## 使用例

### 例1: VRChatの自動インポートをセットアップする

1. ゲーム側設定を開く
2. 「スクリーンショットフォルダ」に`C:\Users\[ユーザー名]\Pictures\VRChat`を設定
3. 「監視」をオンにする
4. 「自動インポート機能」をオンにする
5. 「設定を保存」をクリック
6. VRChatを起動して写真を撮影
7. VSAに自動的に追加される

### 例2: メタデータを取得する

1. ゲーム側設定で「メタデータ出力フォルダ」を設定
2. VRChatでスクリーンショットを撮影
3. 写真詳細サイドバーを開く
4. ワールド名やユーザー名が表示される

### 例3: カメラパラメータを記録する

1. OSCポート番号を確認（デフォルト: 9001）
2. VRChat側でOSCを有効化し、同じポート番号を設定
3. VirtualLens2でスクリーンショットを撮影
4. 写真詳細サイドバーの「カメラ情報」でパラメータを確認

## トラブルシューティング

### 監視が開始できない場合

**症状**: トグルスイッチをオンにしても、監視が開始されない

**解決方法**:
1. フォルダパスが正しいか確認
   - 「スクリーンショットフォルダ」にVRChatの写真フォルダが設定されているか確認
2. ファイアウォール設定を確認
   - Windowsファイアウォールが監視をブロックしていないか確認
3. アプリを再起動
   - VSAとVRChatの両方を再起動してみてください
4. 管理者権限で実行
   - VSAを管理者権限で実行してください

### メタデータが取得できない場合

**症状**: 写真のワールド名やユーザー名が表示されない

**解決方法**:
1. メタデータ出力フォルダが設定されているか確認
   - 「メタデータ出力フォルダ」にログ出力先が設定されているか確認
2. VRChatでメタデータが有効か確認
   - VRChat側でメタデータ出力が有効になっているか確認
3. ログフォルダが正しいか確認
   - VRChatのログファイルが実際に生成されているか確認
4. 詳細ログを確認
   - 開発者モードから詳細ログを確認してください

### OSC通信が確立できない場合

**症状**: カメラパラメータが取得できない

**解決方法**:
1. ポート番号を確認
   - VSAとVRChat側でOSCポート番号が一致しているか確認（デフォルト: 9001）
2. VRChat側でOSCを有効化
   - VRChatの設定で「OSCを有効にする」がチェックされているか確認
3. ファイアウォール設定を確認
   - OSCポート（9001など）がファイアウォールでブロックされていないか確認
4. ポート番号が使用中でないか確認
   - 他のアプリがそのポート番号を使用していないか確認

**ポート競合の確認方法**:
```
netstat -ano | findstr :9001
```

### 設定が保存されない場合

**症状**: 設定を保存ボタンをクリックしても変更が反映されない

**解決方法**:
1. ディスクの空き容量を確認
   - SSDに十分な空き容量があるか確認
2. ファイルのアクセス権限を確認
   - `%APPDATA%/VSA/`ディレクトリへの書き込み権限があるか確認
3. ファイルロックを解除
   - ファイルロックツールで`settings.json`を確認
4. アプリを再起動
   - VSAを再起動して再度設定してください

## タイムマシーン機能

タイムマシーンタブでは、VRChatでの過去の活動履歴を表示し、過去に訪れたインスタンスに再参加できます。

### VRChatタイムライン機能

VRChatのログファイルから活動履歴を自動的に解析し、ビジュアル化します。

**表示される情報**:
- **ワールド移動**: ワールド間の移動履歴
- **ユーザーイベント**: 他ユーザーの参加・退出
- **時系列表示**: 時間順の活動履歴

**タイムラインビュー**:
1. タイムマシーンタブを開く
2. VRChatのログファイルが自動解析されます
3. タイムライン上に活動イベントが表示されます
4. イベントをクリックして詳細を確認

### インスタンス履歴の表示

過去に訪れたインスタンスの一覧を確認できます。

**表示情報**:

| 項目 | 説明 |
|------|------|
| ワールド名 | VRChatのワールド名 |
| インスタンスID | インスタンスの識別子 |
| 訪問日時 | 最後に訪問した日時 |
| 滞在時間 | インスタンスに滞在した時間 |
| ユーザー数 | 訪問時のユーザー数 |

**リスト操作**:
- ワールド名をクリックしてフィルタリング
- インスタンスIDをコピー
- 日時でソート

### ボタンで再参加する方法

インスタンス履歴から直接VRChatに再参加できます。

**再参加手順**:
1. インスタンス履歴から再参加したいインスタンスを選択
2. 「再参加」ボタンをクリック
3. インスタンスURLが自動生成されます
4. VRChat内で再参加ダイアログが表示されます
5. 確認して再参加

**インスタンスURLのコピー**:
1. インスタンスを選択
2. 「URLをコピー」ボタンをクリック
3. インスタンスURLがクリップボードにコピーされます
4. VRChatのJump画面に貼り付けて移動

### 使用例とユースケース

**例1: 好きなワールドに再訪問**
1. タイムマシーンから気になるワールドを見つける
2. 「再参加」をクリック
3. VRChat内で移動が実行される

**例2: イベント開催ワールドの確認**
1. イベント開催日時でフィルタリング
2. その時間帯に訪れたワールドを確認
3. 思い出のワールドに再訪問

**例3: フレンドが訪問したワールドに移動**
1. フレンドのタイムラインイベントを確認
2. 共通の訪問ワールドを発見
3. 再参加で同じワールドに移動

### 注意事項

**ログファイルが必要**:
- VRChatのログファイルが必要です
- ゲーム側設定で「ログフォルダ」が正しく設定されているか確認してください

**プライベートインスタンスについて**:
- プライベートインスタンスに再参加する際は、インスタンス所有者の許可が必要な場合があります
- 削除されたインスタンスには再参加できません

**履歴保持期間**:
- 履歴はVRChatのログファイルに基づいて保持されます
- VRChatがログファイルを削除すると、履歴も表示されなくなります

### トラブルシューティング

**インスタンス履歴が表示されない場合**:
1. ログフォルダの設定を確認
   - ゲーム側設定の「画面設定タブ」でログフォルダが正しいか確認
2. VRChatでログ出力を有効化
   - VRChat設定でログ出力が有効か確認
3. 最近のログファイルを確認
   - VRChatを起動してワールド移動を行い、ログファイルを生成

## サーバーステータス機能

サーバータブでは、VRChatサーバーのステータスを監視し、メンテナンス情報などを確認できます。

### VRChatサーバーステータスの表示

VRChatの公式サーバーステータスをリアルタイムで表示します。

**表示情報**:

| 項目 | 説明 |
|------|------|
| サーバー稼働状態 | オンライン/オフライン/メンテナンス |
| ステータスアイコン | 視覚的なステータス表示 |
| 最終更新日時 | ステータスが最後に更新された日時 |
| 詳細情報 | メンテナンス時の予定時間など |

**ステータスの見方**:
- **緑色**: すべてのサーバーが正常に稼働
- **黄色**: 一部のサーバーに問題が発生
- **赤色**: 主要なサーバーがダウンまたはメンテナンス中

### メンテナンス情報

VRChatのメンテナンス情報を確認できます。

**メンテナンス情報の内容**:
- **メンテナンス開始時刻**: 予定されているメンテナンスの開始時刻
- **予定終了時刻**: 予定されている終了時刻
- **影響範囲**: どのサービスが影響を受けるか
- **説明**: メンテナンス内容の詳細

**更新方法**:
1. 「更新」ボタンをクリックして最新情報を取得
2. 定期的に自動更新される（デフォルト: 5分ごと）

### ステータス送信設定

VRChatへのステータス送信を設定できます。

#### ステータス送信の有効/無効

VRChatにVSAの状態を送信する機能を切り替えます。

**有効時**:
- VRChatにVSAの稼働状況を通知
- VRChat内で確認可能

**無効時**:
- VRChatへの状態送信を停止
- ネットワーク通信が削減される

#### 更新間隔の設定

ステータス更新の間隔を設定します。

**設定値**:
- **1分**: 最新情報を常に確認（ネットワーク負荷が高い）
- **5分**: バランスの取れた設定（デフォルト）
- **10分**: ネットワーク負荷が少ない
- **30分**: ほとんど通信しない

**推奨設定**: 5分〜10分（環境に応じて調整）

### 使用例

**例1: メンテナンス時間の確認**
1. サーバータブを開く
2. メンテナンス情報を確認
3. 終了時間が分かれば、メンテナンス後に接続

**例2: サーバー障害の確認**
1. VRChatに接続できない場合、サーバータブを確認
2. ステータスが「赤色」なら、サーバー側の問題の可能性
3. サポートに連絡する前にサーバーステータスを確認

### トラブルシューティング

**ステータス情報が更新されない場合**:
1. インターネット接続を確認
   - 他のアプリケーションでインターネット接続をテスト
2. ファイアウォール設定を確認
   - ファイアウォールがVSAをブロックしていないか確認
3. 「更新」ボタンで手動更新
   - 定期更新に失敗している可能性があります
4. アプリを再起動
   - VSAを完全に再起動してください

## ヒント

- **複数PCでの設定**: 複数のPCでVSAを使用する場合、各PC上でゲーム側設定を個別に行う必要があります
- **定期的なバックアップ**: 重要な設定は定期的にバックアップしてください
- **パフォーマンス最適化**: 監視とバックグラウンド処理を同時に有効にすると、CPUリソースを消費するため注意してください

## 関連情報

- [VRChat連携ガイド](vrchat-integration.md) - VRChatとの連携詳細
- [JXL圧縮ガイド](jxl-compression.md) - 自動圧縮機能の詳細
- [FAQ](faq.md) - よくある質問と回答
- [トラブルシューティング詳細ガイド](troubleshooting.md) - より詳しい問題解決方法
