# ゲーム側設定ガイド

ゲーム側設定では、VRChat連携に必要なフォルダやOSC通信の設定を行います。この設定を正しく行うことで、VRChatの写真撮影を自動検知し、メタデータを取得できます。

## 概要

ゲーム側設定は以下の機能で構成されています：

- **監視状態**: VRChatの写真撮影を検知するファイル監視のオン/オフ
- **詳細設定**: フォルダパスやOSC通信の詳細設定

## 監視状態の管理

### 監視の開始/停止

ゲーム側設定画面の上部にある**トグルスイッチ**で監視のオン/オフを切り替えられます。

- **有効（オン）**: VRChatでスクリーンショットを撮影すると、自動的にVSAに検知されます
- **無効（オフ）**: VRChatの活動が検知されません。設定変更時や、一時的に監視を停止したい場合に使用します

**ヒント**: 初回セットアップ後は、監視をオンにしておくことをお勧めします。

### 監視状態の確認方法

トグルスイッチの横に現在の状態を示すインジケーターが表示されます：

- **✓ 監視中**: VRChat写真撮影を検知しています
- **停止**: 監視が停止しています

## 詳細設定

「詳細設定」セクションは、デフォルトでは折りたたまれています。セクションのヘッダーをクリックして展開できます。

### フォルダ設定

VRChatの写真やメタデータの保存先フォルダを指定します。

#### スクリーンショットフォルダ設定

**説明**: VRChatが写真を保存するフォルダを指定します。

**初期値**: `C:\Users\[ユーザー名]\Pictures\VRChat`

**設定方法**:
1. 「スクリーンショットフォルダ」の選択ボタンをクリック
2. フォルダ選択ダイアログが開きます
3. VRChatの写真フォルダを選択（通常は`Pictures\VRChat`）
4. 「フォルダを選択」をクリック

**重要**: このフォルダは、VSAがVRChatの写真を自動検知するために使用されます。正しいパスを設定してください。

#### メタデータ出力フォルダ設定

**説明**: VRChatのワールド名やユーザー名などのメタデータを出力するフォルダを指定します。

**初期値**: スクリーンショットフォルダの同じディレクトリ

**設定方法**:
1. 「メタデータ出力フォルダ」の選択ボタンをクリック
2. フォルダ選択ダイアログが開きます
3. メタデータの出力先を選択
4. 「フォルダを選択」をクリック

**ヒント**: VRChatのログフォルダと同じ場所に設定することをお勧めします。

#### ログフォルダ設定

**説明**: VRChatのログファイルが保存されるフォルダを指定します。メタデータの読み込みに使用されます。

**初期値**: VRChatのデフォルトログフォルダ（自動検知）

**設定方法**:
1. 「ログフォルダ」の選択ボタンをクリック
2. フォルダ選択ダイアログが開きます
3. VRChatのログフォルダを選択
4. 「フォルダを選択」をクリック

**デフォルトに戻す**: 「デフォルトに戻す」ボタンをクリックすると、自動検知に戻ります。

**ツールチップでフルパス表示**: 各フォルダ設定の横に、設定されているフルパスが表示されます。マウスをホバーするとツールチップで詳細を確認できます。

### 自動機能設定

VRChatの活動に応じた自動処理を設定します。

#### 自動インポート機能

**説明**: VRChatで撮影した写真を自動的にVSAにインポートします。

**使い方**:
1. トグルスイッチで有効化
2. VRChatでスクリーンショットを撮影
3. 数秒後にVSAのギャラリーに追加されます

**注意**: 監視が有効になっていることを確認してください。

#### 自動圧縮機能

**説明**: VRChatを終了したときに、自動的にJPEG XL圧縮を実行します。

**使い方**:
1. トグルスイッチで有効化
2. 圧縮タイミングを設定（VRChat終了時に実行）
3. VRChatを終了すると自動的に圧縮が開始されます

**設定**: 詳細は[JXL圧縮ガイド](jxl-compression.md)を参照してください。

#### バックグラウンド処理設定

**説明**: アプリ起動時にバックグラウンドで処理を実行するかを設定します。

**使い方**:
1. トグルスイッチで有効化
2. VRChatやインポート処理をバックグラウンドで実行
3. VSAで他の操作を継続できます

### OSC設定

VRChatとの双方向通信（Open Sound Control）を設定します。これにより、VirtualLens2などのカメラパラメータを取得できます。

#### OSCポート設定

**説明**: OSC通信に使用するポート番号を指定します。

**デフォルト**: 9001

**設定方法**:
1. 数値入力フィールドに目的のポート番号を入力
2. VRChat側でも同じポート番号を設定してください

**重要**: VRChat側のOSC設定と一致する必要があります。

#### OSC通信の仕組み

**VRChatとVSAの通信フロー**:
1. VSAがOSCサーバーを起動（指定されたポート番号）
2. VRChatがOSCメッセージを送信
3. VSAがカメラパラメータを受信・記録

**対応するカメラ**:
- VirtualLens2（ズーム、フォーカス距離、絞り値など）
- Integral（シャッター速度、ボケ形状など）
- 通常カメラ

#### カメラパラメータの取得

写真詳細サイドバーの「カメラ情報」セクションで、以下のパラメータを確認できます：

**VirtualLens2パラメータ**:
- Aperture（絞り値）
- Focal Length（焦点距離）
- Exposure（露出）
- Depth of Field（被写界深度）

**Integralパラメータ**:
- Shutter Speed（シャッター速度）
- Bokeh Shape（ボケ形状）
- Film Grain（フィルムグレイン）

## 設定の保存

### 変更検知機能

設定を変更すると、自動的に画面上部に「未保存の変更があります」というインジケーターが表示されます。

### 保存ボタン

詳細設定の下部にある**「設定を保存」ボタン**をクリックすると、すべての変更が保存されます。

### 保存成功/失敗のフィードバック

**保存成功時**:
- 緑色のメッセージ「設定を保存しました」が表示
- インジケーターが消える

**保存失敗時**:
- 赤色のエラーメッセージが表示
- 解決方法を確認して再度保存してください

## 使用例

### 例1: VRChatの自動インポートをセットアップする

1. ゲーム側設定を開く
2. 「スクリーンショットフォルダ」に`C:\Users\[ユーザー名]\Pictures\VRChat`を設定
3. 「監視」をオンにする
4. 「自動インポート機能」をオンにする
5. 「設定を保存」をクリック
6. VRChatを起動して写真を撮影
7. VSAに自動的に追加される

### 例2: メタデータを取得する

1. ゲーム側設定で「メタデータ出力フォルダ」を設定
2. VRChatでスクリーンショットを撮影
3. 写真詳細サイドバーを開く
4. ワールド名やユーザー名が表示される

### 例3: カメラパラメータを記録する

1. OSCポート番号を確認（デフォルト: 9001）
2. VRChat側でOSCを有効化し、同じポート番号を設定
3. VirtualLens2でスクリーンショットを撮影
4. 写真詳細サイドバーの「カメラ情報」でパラメータを確認

## トラブルシューティング

### 監視が開始できない場合

**症状**: トグルスイッチをオンにしても、監視が開始されない

**解決方法**:
1. フォルダパスが正しいか確認
   - 「スクリーンショットフォルダ」にVRChatの写真フォルダが設定されているか確認
2. ファイアウォール設定を確認
   - Windowsファイアウォールが監視をブロックしていないか確認
3. アプリを再起動
   - VSAとVRChatの両方を再起動してみてください
4. 管理者権限で実行
   - VSAを管理者権限で実行してください

### メタデータが取得できない場合

**症状**: 写真のワールド名やユーザー名が表示されない

**解決方法**:
1. メタデータ出力フォルダが設定されているか確認
   - 「メタデータ出力フォルダ」にログ出力先が設定されているか確認
2. VRChatでメタデータが有効か確認
   - VRChat側でメタデータ出力が有効になっているか確認
3. ログフォルダが正しいか確認
   - VRChatのログファイルが実際に生成されているか確認
4. 詳細ログを確認
   - 開発者モードから詳細ログを確認してください

### OSC通信が確立できない場合

**症状**: カメラパラメータが取得できない

**解決方法**:
1. ポート番号を確認
   - VSAとVRChat側でOSCポート番号が一致しているか確認（デフォルト: 9001）
2. VRChat側でOSCを有効化
   - VRChatの設定で「OSCを有効にする」がチェックされているか確認
3. ファイアウォール設定を確認
   - OSCポート（9001など）がファイアウォールでブロックされていないか確認
4. ポート番号が使用中でないか確認
   - 他のアプリがそのポート番号を使用していないか確認

**ポート競合の確認方法**:
```
netstat -ano | findstr :9001
```

### 設定が保存されない場合

**症状**: 設定を保存ボタンをクリックしても変更が反映されない

**解決方法**:
1. ディスクの空き容量を確認
   - SSDに十分な空き容量があるか確認
2. ファイルのアクセス権限を確認
   - `%APPDATA%/VSA/`ディレクトリへの書き込み権限があるか確認
3. ファイルロックを解除
   - ファイルロックツールで`settings.json`を確認
4. アプリを再起動
   - VSAを再起動して再度設定してください

## ヒント

- **複数PCでの設定**: 複数のPCでVSAを使用する場合、各PC上でゲーム側設定を個別に行う必要があります
- **定期的なバックアップ**: 重要な設定は定期的にバックアップしてください
- **パフォーマンス最適化**: 監視とバックグラウンド処理を同時に有効にすると、CPUリソースを消費するため注意してください

## 関連情報

- [VRChat連携ガイド](vrchat-integration.md) - VRChatとの連携詳細
- [JXL圧縮ガイド](jxl-compression.md) - 自動圧縮機能の詳細
- [FAQ](faq.md) - よくある質問と回答
- [トラブルシューティング詳細ガイド](troubleshooting.md) - より詳しい問題解決方法
